<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°ç‹¬æ±‚è§£å™¨ - ç¾åŒ–ç‰ˆ</title>
    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* --- ä¸»å®¹å™¨ --- */
        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            text-align: center;
            max-width: 700px;
            width: 100%;
            backdrop-filter: blur(10px);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 2.2em;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #7f8c8d;
            margin-bottom: 25px;
            font-size: 1.1em;
            font-weight: 400;
        }

        .instructions {
            color: #95a5a6;
            margin-bottom: 30px;
            font-size: 1em;
            line-height: 1.6;
        }

        /* --- æ¨¡å¼é€‰æ‹© --- */
        .mode-selector {
            margin-bottom: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .mode-btn {
            padding: 12px 25px;
            margin: 0 8px;
            font-size: 1.1em;
            font-weight: 600;
            color: #6c757d;
            background-color: #e9ecef;
            border: 2px solid #dee2e6;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .mode-btn.active {
            background-color: #4a90e2;
            color: #fff;
            border-color: #4a90e2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }

        /* --- æ•°ç‹¬è¡¨æ ¼æ ·å¼ --- */
        .sudoku-grid {
            display: inline-grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 1px;
            border: 4px solid #2c3e50;
            margin: 25px auto;
            border-radius: 8px;
            overflow: hidden;
            background-color: #2c3e50;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .sudoku-grid input {
            width: 45px;
            height: 45px;
            text-align: center;
            font-size: 1.4em;
            font-weight: 600;
            border: none;
            background-color: #fff;
            box-sizing: border-box;
            -moz-appearance: textfield;
            transition: all 0.2s ease;
            color: #2c3e50;
        }

        .sudoku-grid input::-webkit-outer-spin-button,
        .sudoku-grid input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .sudoku-grid input:focus {
            outline: none;
            background-color: #e3f2fd;
            box-shadow: inset 0 0 0 3px rgba(33, 150, 243, 0.3);
            transform: scale(1.05);
        }
        
        /* 3x3 å®«æ ¼åˆ†éš”çº¿ */
        .sudoku-grid input:nth-child(3n) {
            border-right: 3px solid #2c3e50;
        }
        .sudoku-grid input:nth-child(n+19):nth-child(-n+27),
        .sudoku-grid input:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 3px solid #2c3e50;
        }

        /* --- åŒºåˆ†ç”¨æˆ·è¾“å…¥ã€ç³»ç»Ÿè§£ç­”å’Œåˆå§‹é¢˜ç›® --- */
        .initial-given {
            color: #2c3e50; /* åˆå§‹é¢˜ç›®ï¼šæ·±ç°è‰² */
            font-weight: 900; /* æ›´ç²—çš„å­—ä½“ */
            background-color: #f8f9fa !important; /* æµ…ç°è‰²èƒŒæ™¯ */
        }

        .user-input {
            color: #2c3e50; /* ç”¨æˆ·è¾“å…¥ï¼šæ·±ç°è‰² */
            font-weight: 600; /* ä¸­ç­‰ç²—ç»† */
            background-color: #e9ecef !important; /* æµ…ç°è‰²èƒŒæ™¯ */
        }

        .solved-answer {
            color: #28a745; /* ç³»ç»Ÿè§£ç­”ï¼šç»¿è‰² */
            font-style: italic; /* æ–œä½“ */
            font-weight: 700; /* æ›´ç²—çš„å­—ä½“ */
            background-color: #e8f5e9 !important; /* æµ…ç»¿è‰²èƒŒæ™¯ */
        }

        /* --- é”™è¯¯æç¤º --- */
        .error-input {
            background-color: #ffebee !important;
            border: 2px solid #f44336 !important;
            color: #c62828 !important;
        }

        /* --- æŒ‰é’®æ ·å¼ --- */
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        button {
            padding: 14px 28px;
            font-size: 1.1em;
            font-weight: 600;
            color: #fff;
            background-color: #4a90e2;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.4);
        }

        button:active {
            transform: translateY(-1px);
        }

        #clearBtn {
            background-color: #6c757d;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        #clearBtn:hover {
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        #checkBtn {
            background-color: #28a745;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        #checkBtn:hover {
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        #generateBtn {
            background-color: #17a2b8;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }
        #generateBtn:hover {
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
        }

        /* --- æ¶ˆæ¯æç¤ºæ ·å¼ --- */
        #message {
            margin: 25px 0 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1em;
            min-height: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .success { 
            color: #155724; 
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .error { 
            color: #721c24; 
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .info { 
            color: #0c5460; 
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
        }
        
        /* --- è¯´æ˜æ–‡å­—æ ·å¼ --- */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0 30px;
            flex-wrap: wrap;
            font-size: 0.95em;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border: 2px solid #6c757d;
            border-radius: 4px;
        }
        
        .legend-given {
            background-color: #f8f9fa;
        }
        
        .legend-user {
            background-color: #e9ecef;
        }
        
        .legend-solved {
            background-color: #e8f5e9;
        }
        
        /* --- å“åº”å¼è®¾è®¡ --- */
        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .sudoku-grid input {
                width: 35px;
                height: 35px;
                font-size: 1.2em;
            }
            
            .mode-btn {
                padding: 10px 15px;
                font-size: 0.9em;
                min-width: 110px;
            }
            
            button {
                padding: 12px 20px;
                font-size: 1em;
                min-width: 100px;
            }
            
            .legend {
                gap: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .buttons {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 250px;
            }
            
            .legend {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ§© æ•°ç‹¬æ±‚è§£å™¨</h1>
        <p class="subtitle">æ™ºèƒ½æ•°ç‹¬åŠ©æ‰‹</p>
        <p class="instructions">é€‰æ‹©æ¨¡å¼ï¼šæ‰‹åŠ¨è¾“å…¥é¢˜ç›®æˆ–æŒ‘æˆ˜ç³»ç»Ÿç”Ÿæˆçš„é¢˜ç›®</p>
        
        <div class="mode-selector">
            <button class="mode-btn active" id="manualModeBtn">æ‰‹åŠ¨è¾“å…¥æ¨¡å¼</button>
            <button class="mode-btn" id="challengeModeBtn">æŒ‘æˆ˜æ¨¡å¼</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color legend-given"></div>
                <span>é¢˜ç›®</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-user"></div>
                <span>ç”¨æˆ·è¾“å…¥</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-solved"></div>
                <span>ç³»ç»Ÿè§£ç­”</span>
            </div>
        </div>

        <div class="sudoku-grid" id="sudoku-grid">
            <!-- 81ä¸ªè¾“å…¥æ¡†å°†ç”±JavaScriptç”Ÿæˆ -->
        </div>

        <div class="buttons">
            <button id="solveBtn">æ±‚è§£</button>
            <button id="checkBtn">æ£€æŸ¥ç­”æ¡ˆ</button>
            <button id="generateBtn">ç”Ÿæˆé¢˜ç›®</button>
            <button id="clearBtn">æ¸…ç©º</button>
        </div>

        <p id="message"></p>
    </div>

    <script>
        // --- DOM å…ƒç´  ---
        const grid = document.getElementById('sudoku-grid');
        const solveBtn = document.getElementById('solveBtn');
        const checkBtn = document.getElementById('checkBtn');
        const generateBtn = document.getElementById('generateBtn');
        const clearBtn = document.getElementById('clearBtn');
        const messageEl = document.getElementById('message');
        const manualModeBtn = document.getElementById('manualModeBtn');
        const challengeModeBtn = document.getElementById('challengeModeBtn');

        let currentMode = 'manual'; // 'manual' æˆ– 'challenge'
        let solutionBoard = null; // å­˜å‚¨å®Œæ•´è§£ç­”
        let challengeBoard = null; // å­˜å‚¨æŒ‘æˆ˜æ¨¡å¼çš„é¢˜ç›®

        // --- åˆå§‹åŒ–ï¼šåˆ›å»º81ä¸ªè¾“å…¥æ¡† ---
        function initializeGrid() {
            grid.innerHTML = '';
            for (let i = 0; i < 81; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.maxLength = 1;
                input.addEventListener('input', (e) => {
                    // åªå…è®¸è¾“å…¥1-9çš„æ•°å­—
                    e.target.value = e.target.value.replace(/[^1-9]/g, '');
                    // è¾“å…¥æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºç”¨æˆ·è¾“å…¥ï¼ˆå¦‚æœä¸æ˜¯åˆå§‹é¢˜ç›®ï¼‰
                    if(e.target.value !== '' && !e.target.classList.contains('initial-given')) {
                        e.target.classList.add('user-input');
                        e.target.classList.remove('solved-answer', 'error-input');
                    } else if(e.target.value === '') {
                        e.target.classList.remove('user-input', 'solved-answer', 'error-input');
                    }
                });
                grid.appendChild(input);
            }
        }

        // --- æ¨¡å¼åˆ‡æ¢ ---
        manualModeBtn.addEventListener('click', () => {
            currentMode = 'manual';
            manualModeBtn.classList.add('active');
            challengeModeBtn.classList.remove('active');
            initializeGrid();
            solutionBoard = null;
            challengeBoard = null;
            showMessage('å·²åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥æ¨¡å¼', 'info');
        });

        challengeModeBtn.addEventListener('click', () => {
            currentMode = 'challenge';
            challengeModeBtn.classList.add('active');
            manualModeBtn.classList.remove('active');
            initializeGrid();
            solutionBoard = null;
            challengeBoard = null;
            showMessage('å·²åˆ‡æ¢åˆ°æŒ‘æˆ˜æ¨¡å¼', 'info');
        });

        // --- ä»è¡¨æ ¼è·å–æ•°æ® ---
        function getBoard() {
            const inputs = grid.querySelectorAll('input');
            const board = [];
            for (let i = 0; i < 9; i++) {
                const row = [];
                for (let j = 0; j < 9; j++) {
                    const input = inputs[i * 9 + j];
                    const value = input.value;
                    row.push(value !== '' ? parseInt(value, 10) : 0);
                }
                board.push(row);
            }
            return board;
        }

        // --- å°†è§£ç­”æ•°æ®å¡«å……å›è¡¨æ ¼ï¼Œå¹¶åº”ç”¨ç³»ç»Ÿè§£ç­”æ ·å¼ ---
        function fillGridWithBoard(board, isSolution = false) {
            const inputs = grid.querySelectorAll('input');
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const input = inputs[i * 9 + j];
                    if (board[i][j] !== 0) {
                        input.value = board[i][j];
                        
                        // æ ¹æ®å½“å‰æ¨¡å¼å’Œè¾“å…¥æƒ…å†µè®¾ç½®æ ·å¼
                        if (currentMode === 'challenge' && challengeBoard && challengeBoard[i][j] !== 0) {
                            // æŒ‘æˆ˜æ¨¡å¼ä¸‹ï¼Œä¿ç•™åˆå§‹é¢˜ç›®æ ·å¼
                            input.classList.add('initial-given');
                            input.classList.remove('user-input', 'solved-answer');
                        } else if (isSolution) {
                            // è§£ç­”æ¨¡å¼ï¼Œæ˜¾ç¤ºä¸ºç³»ç»Ÿè§£ç­”
                            input.classList.add('solved-answer');
                            input.classList.remove('initial-given', 'user-input');
                        } else {
                            // ç”¨æˆ·è¾“å…¥
                            input.classList.add('user-input');
                            input.classList.remove('initial-given', 'solved-answer');
                        }
                    }
                }
            }
        }

        // --- æ˜¾ç¤ºæ¶ˆæ¯ ---
        function showMessage(text, type) {
            messageEl.textContent = text;
            messageEl.className = type;
        }

        // --- æ•°ç‹¬æ±‚è§£æ ¸å¿ƒé€»è¾‘ ---
        function solveSudoku(board) {
            const findEmpty = (b) => {
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        if (b[r][c] === 0) return [r, c];
                    }
                }
                return null;
            };

            const isValid = (b, row, col, num) => {
                // æ£€æŸ¥è¡Œ
                for (let c = 0; c < 9; c++) {
                    if (b[row][c] === num) return false;
                }
                // æ£€æŸ¥åˆ—
                for (let r = 0; r < 9; r++) {
                    if (b[r][col] === num) return false;
                }
                // æ£€æŸ¥ 3x3 å®«
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                for (let r = startRow; r < startRow + 3; r++) {
                    for (let c = startCol; c < startCol + 3; c++) {
                        if (b[r][c] === num) return false;
                    }
                }
                return true;
            };
            
            const solve = () => {
                const emptyPos = findEmpty(board);
                if (!emptyPos) return true;

                const [r, c] = emptyPos;
                for (let num = 1; num <= 9; num++) {
                    if (isValid(board, r, c, num)) {
                        board[r][c] = num;
                        if (solve()) return true;
                        board[r][c] = 0;
                    }
                }
                return false;
            };

            return solve();
        }

        // --- ç”Ÿæˆéšæœºæ•°ç‹¬é¢˜ç›® ---
        function generateSudoku() {
            // åˆ›å»ºä¸€ä¸ªç©ºçš„æ•°ç‹¬æ¿
            const board = Array(9).fill().map(() => Array(9).fill(0));
            
            // éšæœºå¡«å……å¯¹è§’çº¿ä¸Šçš„3x3å®«æ ¼ï¼ˆè¿™äº›å®«æ ¼ä¹‹é—´ä¸ç›¸äº’å½±å“ï¼‰
            for (let i = 0; i < 9; i += 3) {
                fillDiagonalBox(board, i, i);
            }
            
            // æ±‚è§£å®Œæ•´æ•°ç‹¬
            solveSudoku(board);
            
            // åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ä½œä¸ºé¢˜ç›®
            const puzzle = board.map(row => [...row]);
            
            // éšæœºæŒ–ç©ºä¸€äº›æ•°å­—ï¼ˆæŒ–ç©ºæ•°é‡å¯ä»¥æ ¹æ®éš¾åº¦è°ƒæ•´ï¼‰
            const cellsToRemove = 45; // æŒ–ç©º45ä¸ªæ ¼å­ï¼Œä¿ç•™36ä¸ª
            let removed = 0;
            
            while (removed < cellsToRemove) {
                const row = Math.floor(Math.random() * 9);
                const col = Math.floor(Math.random() * 9);
                
                if (puzzle[row][col] !== 0) {
                    const backup = puzzle[row][col];
                    puzzle[row][col] = 0;
                    
                    // æ£€æŸ¥æ˜¯å¦ä»ç„¶æœ‰å”¯ä¸€è§£
                    const boardCopy = puzzle.map(r => [...r]);
                    if (solveSudoku(boardCopy)) {
                        removed++;
                    } else {
                        puzzle[row][col] = backup; // å¦‚æœä¸å”¯ä¸€åˆ™æ¢å¤
                    }
                }
            }
            
            return { puzzle, solution: board };
        }

        // --- å¡«å……å¯¹è§’çº¿ä¸Šçš„3x3å®«æ ¼ ---
        function fillDiagonalBox(board, row, col) {
            const nums = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            // éšæœºæ‰“ä¹±æ•°ç»„
            for (let i = nums.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [nums[i], nums[j]] = [nums[j], nums[i]];
            }
            
            let idx = 0;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    board[row + i][col + j] = nums[idx++];
                }
            }
        }

        // --- éªŒè¯ç”¨æˆ·ç­”æ¡ˆ ---
        function checkAnswer(userBoard) {
            if (!solutionBoard) {
                showMessage('è¯·å…ˆç”Ÿæˆé¢˜ç›®ï¼', 'error');
                return false;
            }

            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ ¼å­éƒ½å·²å¡«å†™
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (userBoard[i][j] === 0) {
                        showMessage('è¿˜æœ‰ç©ºæ ¼æœªå¡«å†™ï¼', 'error');
                        return false;
                    }
                }
            }

            // æ£€æŸ¥ç”¨æˆ·ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
            let isCorrect = true;
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (userBoard[i][j] !== solutionBoard[i][j]) {
                        isCorrect = false;
                        break;
                    }
                }
                if (!isCorrect) break;
            }

            // é«˜äº®é”™è¯¯æ ¼å­
            highlightErrors(userBoard);

            if (isCorrect) {
                showMessage('ğŸ‰ æ­å–œï¼ç­”æ¡ˆå®Œå…¨æ­£ç¡®ï¼', 'success');
                return true;
            } else {
                showMessage('âŒ ç­”æ¡ˆæœ‰è¯¯ï¼Œè¯·æ£€æŸ¥ï¼', 'error');
                return false;
            }
        }

        // --- é«˜äº®é”™è¯¯æ ¼å­ ---
        function highlightErrors(userBoard) {
            const inputs = grid.querySelectorAll('input');
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const input = inputs[i * 9 + j];
                    // åªé«˜äº®ç”¨æˆ·è¾“å…¥çš„æ ¼å­
                    if (!input.classList.contains('initial-given') && 
                        userBoard[i][j] !== 0 && 
                        userBoard[i][j] !== solutionBoard[i][j]) {
                        input.classList.add('error-input');
                    } else {
                        input.classList.remove('error-input');
                    }
                }
            }
        }

        // --- äº‹ä»¶ç›‘å¬å™¨ ---
        solveBtn.addEventListener('click', () => {
            if (currentMode === 'challenge' && !challengeBoard) {
                showMessage('è¯·å…ˆç”Ÿæˆé¢˜ç›®ï¼', 'error');
                return;
            }
            
            showMessage('æ­£åœ¨æ±‚è§£ä¸­...', 'info');
            setTimeout(() => {
                const board = getBoard();
                if (solveSudoku(board)) {
                    fillGridWithBoard(board, true);
                    showMessage('âœ… æ±‚è§£æˆåŠŸï¼', 'success');
                } else {
                    showMessage('âŒ æ­¤æ•°ç‹¬æ— è§£æˆ–é¢˜ç›®æœ‰è¯¯ï¼', 'error');
                }
            }, 100);
        });

        checkBtn.addEventListener('click', () => {
            if (currentMode !== 'challenge') {
                showMessage('è¯·åˆ‡æ¢åˆ°æŒ‘æˆ˜æ¨¡å¼ï¼', 'error');
                return;
            }
            
            if (!challengeBoard) {
                showMessage('è¯·å…ˆç”Ÿæˆé¢˜ç›®ï¼', 'error');
                return;
            }
            
            const userBoard = getBoard();
            checkAnswer(userBoard);
        });

        generateBtn.addEventListener('click', () => {
            if (currentMode !== 'challenge') {
                showMessage('è¯·åˆ‡æ¢åˆ°æŒ‘æˆ˜æ¨¡å¼ï¼', 'error');
                return;
            }
            
            const { puzzle, solution } = generateSudoku();
            challengeBoard = puzzle;
            solutionBoard = solution;
            fillGridWithBoard(puzzle);
            showMessage('âœ… é¢˜ç›®ç”ŸæˆæˆåŠŸï¼è¯·å¼€å§‹è§£ç­”ã€‚', 'success');
        });

        clearBtn.addEventListener('click', () => {
            initializeGrid();
            if (currentMode === 'challenge') {
                challengeBoard = null;
                solutionBoard = null;
            }
            showMessage('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰æ ¼å­ã€‚', 'info');
        });

        // --- é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeGrid();
        });
    </script>

</body>
</html>



